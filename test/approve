#!/usr/bin/env bash
# Run this from the root directory

set -e

cd ./test || exit
source approvals.bash

# Set SKIP_INTEGRATION=1 to skip integration tests
SKIP_INTEGRATION=${SKIP_INTEGRATION:-0}

# Export paths for use in test specs
export FIXTURES_PATH="$PWD/fixtures"
export LIB_PATH="$PWD/../src/lib"
export CLI_PATH="$PWD/../dist/stash"
export APPROVALS_BASH="$PWD/approvals.bash"

# Run all spec files from cases directory
for file in cases/*_spec.sh ; do
  # Extract filename for display and pattern matching
  filename=$(basename "$file")
  
  # Skip integration tests if requested
  if [[ "$SKIP_INTEGRATION" == "1" ]] && [[ "$filename" =~ ^integration_ ]]; then
    echo "Skipping integration test: $filename"
    continue
  fi
  
  context "$filename"
  ./"$file"
done
